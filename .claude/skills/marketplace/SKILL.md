---
description: "–ú–æ–¥—É–ª—å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤: –ø–∞—Ä—Å–∏–Ω–≥, —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∞–º–∏"
disable-model-invocation: false
user-invocable: true
---

# Marketplace ‚Äî –º–æ–¥—É–ª—å —Ä–∞–±–æ—Ç—ã —Å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞–º–∏

## –§–∞–π–ª—ã –º–æ–¥—É–ª—è

```
src/shared/marketplace/
‚îî‚îÄ‚îÄ extract.js + extract.d.ts    # –ü–∞—Ä—Å–∏–Ω–≥ —Å—Å—ã–ª–æ–∫ –∏–∑ Telegram-—Å–æ–æ–±—â–µ–Ω–∏–π; getMarketplaceType()

src/entrypoints/
‚îî‚îÄ‚îÄ check.js                     # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å—Å—ã–ª–æ–∫ –ø–æ –¥–∞–≤–Ω–æ—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏; console.log
```

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—ã

`ozon.ru`, `wildberries.ru` ‚Äî –¥–æ–º–µ–Ω—ã –≤ `MARKETPLACE_HOSTS` –≤ `extract.js`

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–æ–∫ (GitHub Action)

`.github/workflows/check.yml` ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ä–∞–∑ –≤ –ø–æ–ª—á–∞—Å–∞ (`cron: '0,30 * * * *'`):
- –ó–∞–ø—É—Å–∫–∞–µ—Ç `node src/entrypoints/check.js`
- –ß–∏—Ç–∞–µ—Ç –≤—Å–µ —Å—Å—ã–ª–∫–∏ –∏–∑ Firestore —á–µ—Ä–µ–∑ `listLinks()`
- –°–æ—Ä—Ç–∏—Ä—É–µ—Ç –ø–æ `checkedAt` asc: –±–µ–∑ `checkedAt` (–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∏—Å—å) –∏–¥—É—Ç –ø–µ—Ä–≤—ã–º–∏
- –í—ã–≤–æ–¥–∏—Ç —á–µ—Ä–µ–∑ `console.log`: `[<ISO –¥–∞—Ç–∞> | never] <id> ‚Äî <url>`
- –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ —Å–µ–π—á–∞—Å –∑–∞–≥–ª—É—à–∫–∞ ‚Äî –ø–∞—Ä—Å–∏–Ω–≥–∞ –Ω–µ—Ç, `checkedAt` –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

## Firestore-—Å—Ö–µ–º–∞ —Å—Å—ã–ª–æ–∫ (`links/{chatId}_{messageId}`)

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|---------|
| `url` | string | –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π URL |
| `chatId` | string | ID —á–∞—Ç–∞ |
| `createdAt` | Timestamp | –î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è |
| `checkedAt` | Timestamp? | –ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞ |
| `name` | string? | –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ |
| `price` | number? | –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞, —Ä—É–± |
| `invalidAt` | Timestamp? | –ö–æ–≥–¥–∞ –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ —É–¥–∞–ª—Å—è (–ø–æ–ª–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç = –≤—Å—ë –æ–∫) |

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ (verified/admin)

- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—Å—ã–ª–∫–∏ ozon.ru/wildberries.ru ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `links/{chatId}_{messageId}`
- `/list` ‚Üí —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—Å—ã–ª–æ–∫ —Å –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∞–º–∏ [–ù–∞–∑–≤–∞–Ω–∏–µ] [üóë]
- callback `view:<id>` ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å URL —Å—Å—ã–ª–∫–∏
- callback `del:<id>` ‚Üí —É–¥–∞–ª–∏—Ç—å —Å—Å—ã–ª–∫—É –∏–∑ Firestore

## –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å

1. `extract.js` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–º–µ–Ω –≤ `MARKETPLACE_HOSTS`
2. `extract.js` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å regex-—Ñ–æ–ª–±—ç–∫ –∏ –¥–æ–±–∞–≤–∏—Ç—å –≤–µ—Ç–∫—É –≤ `getMarketplaceType()`

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `firestore.js` ‚Äî `saveLink()`, `listLinks()`, `getLink()`, `deleteLink()`, `updateLinkData()`
- `messages.js` ‚Äî `MSG_LINK_SAVED`, `MSG_LINK_NOT_FOUND`, `msgList()`
- `poll.js` ‚Äî –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è: extract ‚Üí save / list / view / delete ‚Üí respond
